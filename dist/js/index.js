/*
 * Copyright (c) 2017 Dmytro Meleshko
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";function setup(){snake=[{x:Math.floor(FIELD_WIDTH/2),y:Math.floor(FIELD_HEIGHT/2),direction:["left","up","right","down"][Math.floor(4*Math.random())]}],fruit={x:Math.floor(Math.random()*FIELD_WIDTH),y:Math.floor(Math.random()*FIELD_HEIGHT)},score=0,drawScore(),time=0,canTurn=!0}function drawScore(){scoreCounter.html(score),score>highScore&&(highScore=score),highScoreCounter.html(highScore)}function draw(){context.strokeStyle="black",context.fillStyle="black",context.clearRect(0,0,canvas.width,canvas.height),context.strokeRect(0,0,canvas.width,canvas.height),context.fillCircle(fruit.x,fruit.y,CELL_SIZE/2-1);var e,t,o=_.last(snake).x,a=_.last(snake).y,r=_.last(snake).direction,n=_.head(snake);for(t=1;t<snake.length;t++)if(e=snake[t],n.x==e.x&&n.y==e.y){clearInterval(gameLoopInterval),clearInterval(timeUpdateInterval);var i=!0,d=setInterval(function(){if(context.clearRect(0,0,canvas.width,canvas.height),context.strokeRect(0,0,canvas.width,canvas.height),i)for(t=0;t<snake.length;t++)e=snake[t],context.fillRect(e.x*CELL_SIZE,e.y*CELL_SIZE,CELL_SIZE,CELL_SIZE);i=!i},SNAKE_BLINKING_INTERVAL_MS);return void setTimeout(function(){clearInterval(d),youDiedModalScore.html(score),youDiedModalTime.html(time+" sec"),youDiedModal.modal("show")},SNAKE_BLINKING_TIME_MS)}for(t=0;t<snake.length;t++)e=snake[t],context.fillRect(e.x*CELL_SIZE,e.y*CELL_SIZE,CELL_SIZE,CELL_SIZE),"left"==e.direction?e.x--:"up"==e.direction?e.y--:"right"==e.direction?e.x++:"down"==e.direction&&e.y++,e.x=normalizeCoord(e.x,FIELD_WIDTH),e.y=normalizeCoord(e.y,FIELD_HEIGHT);for(n.x==fruit.x&&n.y==fruit.y&&(snake.push({x:o,y:a,direction:r}),fruit={x:Math.floor(Math.random()*FIELD_WIDTH),y:Math.floor(Math.random()*FIELD_HEIGHT)},score++,drawScore()),t=snake.length-1;t>=1;t--){e=snake[t];var c=snake[t-1];e.direction=c.direction}canTurn=!0}function normalizeCoord(e,t){return e%=t,e<0&&(e=t+e),e}function runGame(){setup(),timeUpdateInterval=setInterval(function(){timeCounter.html(time+" sec"),time++},1e3),gameLoopInterval=setInterval(draw,GAME_LOOP_INTERVAL_MS)}var canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),scoreCounter=$("#score-counter"),highScoreCounter=$("#high-score-counter"),timeCounter=$("#time-counter"),leaderboard=$("#leaderboard > tbody"),youDiedModal=$("#you-died-modal"),youDiedModalPlayerName=$("#you-died-modal #player-name"),youDiedModalScore=$("#you-died-modal #statistics-score"),youDiedModalTime=$("#you-died-modal #statistics-time"),gameLoopInterval,timeUpdateInterval,CANVAS_TO_PARENT_SIZE_PROPORTION=1.1;canvas.height=canvas.width=$(canvas).parent().width()/CANVAS_TO_PARENT_SIZE_PROPORTION;var FIELD_WIDTH=30,FIELD_HEIGHT=30,CELL_SIZE=canvas.width/FIELD_WIDTH,GAME_LOOP_INTERVAL_MS=100,SNAKE_BLINKING_INTERVAL_MS=150,SNAKE_BLINKING_TIME_MS=2e3;$(window).on("resize",_.debounce(function(){canvas.height=canvas.width=$(canvas).parent().width()/CANVAS_TO_PARENT_SIZE_PROPORTION,CELL_SIZE=canvas.width/FIELD_WIDTH},GAME_LOOP_INTERVAL_MS));var KEY_CODES={leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,w:87,a:65,s:83,d:68,enter:13};youDiedModal.on("shown.bs.modal",function(){youDiedModalPlayerName.focus()}),youDiedModal.on("hidden.bs.modal",function(){var e=youDiedModalPlayerName.val();_.isEmpty(e)||leaderboard.prepend("<tr><td>"+e+"</td><td>"+score+"</td><td>"+time+" sec</td></tr>"),youDiedModalPlayerName.val(""),runGame()}),youDiedModalPlayerName.keyup(function(e){e.keyCode==KEY_CODES.enter&&youDiedModal.modal("hide")}),context.fillCircle=function(e,t,o){this.beginPath();var a=e*CELL_SIZE+o,r=t*CELL_SIZE+o;this.arc(a,r,o,0,2*Math.PI),this.fill()};var snake,fruit,score,time,canTurn,highScore=0;$(document.body).on("keydown",function(e){if(canTurn){canTurn=!1;var t=e.keyCode,o=_.head(snake);t!=KEY_CODES.leftArrow&&t!=KEY_CODES.a||"right"==o.direction?t!=KEY_CODES.upArrow&&t!=KEY_CODES.w||"down"==o.direction?t!=KEY_CODES.rightArrow&&t!=KEY_CODES.d||"left"==o.direction?t!=KEY_CODES.downArrow&&t!=KEY_CODES.s||"up"==o.direction||(o.direction="down"):o.direction="right":o.direction="up":o.direction="left"}}),runGame();
//# sourceMappingURL=index.js.map
